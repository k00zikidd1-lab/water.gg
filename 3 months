local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local StarterGui = game:GetService("StarterGui")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local camera = Workspace.CurrentCamera
local run = game:GetService("RunService")

local lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/k00zikidd1-lab/FemWare/refs/heads/main/UI%20lol", true))()
local esp = loadstring(game:HttpGet("https://raw.githubusercontent.com/JackHiggly/FemWare/refs/heads/main/ESP", true))()

local water = lib:CreateWindow('Water.gg 1.0.2a', Vector2.new(550, 700))

local main = water:CreateTab("Combat")
local visuals = water:CreateTab("Visuals")

local weapon = main:CreateSector("Weapon Assist", "right")
local pesp = visuals:CreateSector("Player Visuals", "left")

local cockie = {}
local functions = { 
    SilentAim = false,
    aimbot = false,
    wall = false,
    smooth = false,
    smoothsize = 0.1,
    fov = false,
    fovsize = 100,
    team = false,
    RageBot = false,
    SilentMiddle = false,
    AimbotMiddle = false
}

local SectionSettings = {
    SilentAim = {
        Toggle = false,
        ShowFOV = false,
        DrawSize = 130,
        DrawColor = Color3.new(1, 1, 1),
        Thickness = 2,
        TargetParts = {"Head"},
        CheckDowned = false,
        CheckWall = false,
        CheckFF = false,
        CheckTeam = false,
        CheckWhiteList = false,
        HitChance = 100,
        HitChanceToggle = false
    }
}

local Settings = {
    checkDowned = false,
    wallCheck = false,
    hitlogEnabled = false,
    checkWhitelist = false,
    checkTarget = false,
    useFOV = false,
    teamCheck = false,
    fovRadius = 75,
    shootSpeed = 15,
    fireInterval = 0.17,
    maxDistance = 100,
    bulletTracerEnabled = false,
    tracerColor = Color3.fromRGB(255, 0, 0),
    showFOV = false
}

local Events = ReplicatedStorage:WaitForChild("Events")
local GNX_S = Events:WaitForChild("GNX_S")
local ZFKLF__H = Events:WaitForChild("ZFKLF__H")

local WallbangSamples = 72
local WallbangRadius = 10
local WallbangHeight = 6
local NOTIFY_COOLDOWN = 0.35
local lastHitNotify = {}
local lastShotTime = 0

local function RandomString(len)
    local s = ""
    for i = 1, len do s = s .. string.char(math.random(97, 122)) end
    return s
end

local function IsPlayerDowned(p)
    if not p or not p.Character then return false end
    local hum = p.Character:FindFirstChildOfClass("Humanoid")
    if hum and hum.Health <= 15 then return true end
    
    local cs = p.Character:FindFirstChild("CharStats")
    if cs then
        local downed = cs:FindFirstChild("Downed")
        if downed and typeof(downed.Value) == "boolean" then
            return downed.Value
        end
    end
    return false
end

local function SetupSilentAim()
    if cockie.SilentAimCircle then cockie.SilentAimCircle:Remove() end
    
    cockie.SilentAimCircle = Drawing.new("Circle")
    cockie.SilentAimCircle.Color = SectionSettings.SilentAim.DrawColor
    cockie.SilentAimCircle.Thickness = SectionSettings.SilentAim.Thickness
    cockie.SilentAimCircle.NumSides = 50
    cockie.SilentAimCircle.Radius = SectionSettings.SilentAim.DrawSize
    cockie.SilentAimCircle.Filled = false
    cockie.SilentAimCircle.Visible = false

    local target = nil
    local VisualizeEvent = ReplicatedStorage:WaitForChild("Events2"):WaitForChild("Visualize")

    local function GetClosest()
        target = nil
        local shortest = SectionSettings.SilentAim.ShowFOV and SectionSettings.SilentAim.DrawSize or math.huge
        local center = functions.SilentMiddle and Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2) or UserInputService:GetMouseLocation()

        for _, a in pairs(Players:GetPlayers()) do
            if a ~= LocalPlayer and a.Character and a.Character:FindFirstChild("HumanoidRootPart") then
                if SectionSettings.SilentAim.CheckDowned and IsPlayerDowned(a) then continue end
                if SectionSettings.SilentAim.CheckTeam and a.Team == LocalPlayer.Team then continue end

                local hrp = a.Character.HumanoidRootPart
                local screenpos, onScreen = Camera:WorldToViewportPoint(hrp.Position)

                if onScreen then
                    local dist = (center - Vector2.new(screenpos.X, screenpos.Y)).Magnitude
                    if dist < shortest then
                        shortest = dist
                        target = a
                    end
                end
            end
        end
    end

    RunService.RenderStepped:Connect(function()
        if cockie.SilentAimCircle then
            local pos = functions.SilentMiddle and Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2) or UserInputService:GetMouseLocation()
            cockie.SilentAimCircle.Visible = functions.SilentAim and SectionSettings.SilentAim.ShowFOV
            cockie.SilentAimCircle.Radius = SectionSettings.SilentAim.DrawSize
            cockie.SilentAimCircle.Position = pos
        end
        if functions.SilentAim then
            GetClosest()
        end
    end)

    VisualizeEvent.Event:Connect(function(_, ShotCode, _, Gun, _, StartPos, BulletsPerShot)
        if not functions.SilentAim or not target or not target.Character then return end
        if not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChildOfClass("Tool") then return end

        if SectionSettings.SilentAim.HitChanceToggle then
            if math.random(1, 100) > SectionSettings.SilentAim.HitChance then return end
        end

        local possibleParts = SectionSettings.SilentAim.TargetParts
        local parts = possibleParts[math.random(1, #possibleParts)] or "Head"
        local targetPart = target.Character:FindFirstChild(parts)
        
        if targetPart then
            local partPos = targetPart.Position
            local bulletCount = type(BulletsPerShot) == "table" and #BulletsPerShot or 1
            
            task.wait(0.005)
            for i = 1, math.clamp(bulletCount, 1, 100) do
                local dir = (partPos - StartPos).Unit
                ZFKLF__H:FireServer("ðŸ§ˆ", Gun, ShotCode, i, targetPart, partPos, dir)
            end

            if Gun:FindFirstChild("Hitmarker") then
                Gun.Hitmarker:Fire(targetPart)
            end
        end
    end)
end

local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.new(1, 1, 1)
fovCircle.Thickness = 1
fovCircle.NumSides = 50
fovCircle.Filled = false
fovCircle.Visible = false

run.RenderStepped:Connect(function()
    local pos = functions.AimbotMiddle and Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2) or UserInputService:GetMouseLocation()
    fovCircle.Visible = functions.fov
    fovCircle.Radius = functions.fovsize
    fovCircle.Position = pos
end)

local function aimbotLoop()
    while true do 
        if functions.aimbot then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild('Head') then
                local targetPart = nil
                local shortestDistance = functions.fovsize
                local center = functions.AimbotMiddle and Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2) or UserInputService:GetMouseLocation()
                
                for _, p in pairs(Players:GetPlayers()) do
                    if functions.team and p.Team == LocalPlayer.Team then continue end
                    if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild('Head') then
                        local pos, onscreen = camera:WorldToViewportPoint(p.Character.Head.Position)
                        if onscreen then
                            local mousedistance = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                            if mousedistance <= functions.fovsize then
                                local cansee = true
                                if functions.wall then
                                    local rayParams = RaycastParams.new()
                                    rayParams.FilterDescendantsInstances = {character, camera}
                                    rayParams.FilterType = Enum.RaycastFilterType.Exclude
                                    local rayResult = Workspace:Raycast(camera.CFrame.Position, (p.Character.Head.Position - camera.CFrame.Position), rayParams)
                                    if rayResult and not rayResult.Instance:IsDescendantOf(p.Character) then cansee = false end
                                end
                                if cansee and mousedistance < shortestDistance then
                                    shortestDistance = mousedistance
                                    targetPart = p.Character.Head
                                end
                            end
                        end
                    end
                end
                if targetPart then
                    local goal = CFrame.new(camera.CFrame.Position, targetPart.Position)
                    camera.CFrame = functions.smooth and camera.CFrame:Lerp(goal, functions.smoothsize/100) or goal
                end
            end
        end
        task.wait()
    end
end
task.spawn(aimbotLoop)

local function createTracer(startPos, endPos)
    if not Settings.bulletTracerEnabled then return end
    local tracer = Instance.new("Part")
    tracer.Anchored = true
    tracer.CanCollide = false
    tracer.Material = Enum.Material.Neon
    tracer.Color = Settings.tracerColor
    tracer.Shape = Enum.PartType.Cylinder
    local distance = (startPos - endPos).Magnitude
    tracer.Size = Vector3.new(distance, 0.12, 0.12)
    tracer.CFrame = CFrame.new((startPos + endPos) / 2, endPos) * CFrame.Angles(0, math.pi / 2, 0)
    tracer.Parent = Workspace
    task.spawn(function()
        for t = 0, 1, 0.02 do
            if tracer and tracer.Parent then
                tracer.Transparency = t
                task.wait(1/50)
            end
        end
        if tracer and tracer.Parent then tracer:Destroy() end
    end)
end

local function MakeRaycastParams()
    local rp = RaycastParams.new()
    rp.FilterType = Enum.RaycastFilterType.Exclude
    rp.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    rp.IgnoreWater = true
    return rp
end

local function FindWallbangPoint(origin, targetPart)
    if not origin or not targetPart then return nil end
    local base = targetPart.Position
    local rp = MakeRaycastParams()
    for i = 1, WallbangSamples do
        local angle = (i / WallbangSamples) * math.pi * 2
        local r = WallbangRadius * (0.6 + math.random() * 0.8)
        local yOff = (math.random() * 2 - 1) * WallbangHeight
        local offset = Vector3.new(math.cos(angle) * r, yOff, math.sin(angle) * r)
        local testPoint = base + offset
        local dir = (testPoint - origin)
        if dir.Magnitude > 0 then
            local result = Workspace:Raycast(origin, dir, rp)
            if result then
                if result.Instance and result.Instance:IsDescendantOf(targetPart.Parent) then
                    return testPoint
                else
                    local distHitToTarget = (result.Position - base).Magnitude
                    if distHitToTarget <= 2.0 then
                        return testPoint
                    end
                end
            else
                return testPoint
            end
        end
    end
    return nil
end

local function GetClosestEnemy()
    local me = LocalPlayer.Character
    if not me or not me:FindFirstChild("HumanoidRootPart") then return nil end
    local closest, shortest = nil, math.huge
    local originPos = me.HumanoidRootPart.Position

    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character then
            if Settings.teamCheck and p.Team == LocalPlayer.Team then continue end
            if Settings.checkDowned and IsPlayerDowned(p) then continue end
            
            local head = p.Character:FindFirstChild("Head")
            if head then
                local dist3D = (originPos - head.Position).Magnitude
                if dist3D <= Settings.maxDistance then
                    local center = functions.SilentMiddle and Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2) or UserInputService:GetMouseLocation()
                    local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                    if onScreen then
                        local d2 = (Vector2.new(screenPos.X, screenPos.Y) - center).Magnitude
                        if d2 <= (Settings.useFOV and Settings.fovRadius or math.huge) and d2 < shortest then
                            shortest = d2
                            closest = p
                        end
                    end
                end
            end
        end
    end
    return closest
end

local function Shoot(target)
    if not target or not target.Character then return end
    local head = target.Character:FindFirstChild("Head")
    local tool = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Tool")
    if not head or not tool then return end
    
    local handle = tool:FindFirstChild("WeaponHandle")
    local origin = (handle and handle.Position) or Camera.CFrame.Position
    local aimPos = head.Position
    local dir = (aimPos - origin)
    local rp = MakeRaycastParams()

    local ray = Workspace:Raycast(origin, dir, rp)
    local lineOfSight = (not ray) or (ray.Instance and ray.Instance:IsDescendantOf(target.Character))

    local chosenAimPoint = aimPos
    local wallbangFound = false
    if not lineOfSight then
        local found = FindWallbangPoint(origin, head)
        if found then
            chosenAimPoint = found
            wallbangFound = true
        end
    end

    if not lineOfSight and Settings.wallCheck and not wallbangFound then
        return
    end

    local finalDir = (chosenAimPoint - origin).Unit
    local key = RandomString(30) .. "0"

    pcall(function() GNX_S:FireServer(tick(), key, tool, "FDS9I83", origin, {finalDir}, false) end)
    pcall(function() ZFKLF__H:FireServer("ðŸ§ˆ", tool, key, 1, head, chosenAimPoint, finalDir) end)

    createTracer(origin, chosenAimPoint)

    if Settings.hitlogEnabled then
        local now = tick()
        if not lastHitNotify[target.UserId] or now - lastHitNotify[target.UserId] >= NOTIFY_COOLDOWN then
            lastHitNotify[target.UserId] = now
            StarterGui:SetCore("SendNotification", {Title = "RageBot Hit", Text = "Hit " .. target.Name, Duration = 2})
        end
    end
end

RunService.Heartbeat:Connect(function()
    if not functions.RageBot then return end
    local now = tick()
    if now - lastShotTime < Settings.fireInterval then return end
    
    local target = GetClosestEnemy()
    if target then
        Shoot(target)
        lastShotTime = now
    end
end)

task.spawn(SetupSilentAim)

weapon:AddSeperator("Silent Aim")

weapon:AddToggle("Silent Aim", SectionSettings.SilentAim.Toggle, function(V)
    SectionSettings.SilentAim.Toggle = V
    functions.SilentAim = V
end)

weapon:AddToggle("Silent FOV in Middle", functions.SilentMiddle, function(V)
    functions.SilentMiddle = V
end)

weapon:AddToggle("Check Downed", SectionSettings.SilentAim.CheckDowned, function(V)
    SectionSettings.SilentAim.CheckDowned = V
end)

weapon:AddToggle("Check Team", SectionSettings.SilentAim.CheckTeam, function(V)
    SectionSettings.SilentAim.CheckTeam = V
end)

weapon:AddToggle("Silent Aim Hit Chance", SectionSettings.SilentAim.HitChanceToggle, function(V)
    SectionSettings.SilentAim.HitChanceToggle = V
end):AddSlider(0, SectionSettings.SilentAim.HitChance, 100, 1, function(V)
SectionSettings.SilentAim.HitChance = V
end)

weapon:AddToggle("FOV Circle", SectionSettings.SilentAim.ShowFOV, function(V)
    SectionSettings.SilentAim.ShowFOV = V
end):AddSlider(50, SectionSettings.SilentAim.DrawSize, 800, 1, function(V)
    SectionSettings.SilentAim.DrawSize = V
end)

weapon:AddSeperator("Aimbot")

weapon:AddToggle("Aimbot", functions.aimbot, function(V)
    functions.aimbot = V
end)

weapon:AddToggle("Aimbot FOV in Middle", functions.AimbotMiddle, function(V)
    functions.AimbotMiddle = V
end)

weapon:AddToggle("Wall Check", functions.wall, function(V)
    functions.wall = V
end)

weapon:AddToggle("Enable Smooth", functions.smooth, function(V)
    functions.smooth = V
end):AddSlider(0, functions.smoothsize, 100, 1, function(V)
    functions.smoothsize = V
end)

weapon:AddToggle("Show FOV", functions.fov, function(V)
    functions.fov = V
end):AddSlider(50, functions.fovsize, 800, 1, function(V)
    functions.fovsize = V
end)

weapon:AddSeperator("Rage Bot")

weapon:AddToggle("Rage Bot", functions.RageBot, function(V)
    functions.RageBot = V
end)

weapon:AddToggle("Check Downed", Settings.checkDowned, function(V)
    Settings.checkDowned = V
end)

weapon:AddToggle("Check Wall", Settings.wallCheck, function(V)
    Settings.wallCheck = V
end)

weapon:AddToggle("Hitlog", Settings.hitlogEnabled, function(V)
    Settings.hitlogEnabled = V
end)

pesp:AddToggle("Show Names", esp.Names, function(V)
    esp.Names = V
end)

pesp:AddToggle("Show Health", esp.Health, function(V)
    esp.Health = V
end)

pesp:AddToggle("Show Distance", esp.Distance, function(V)
    esp.Distance = V
end)

pesp:AddToggle("Face Camera", esp.FaceCamera, function(V)
    esp.FaceCamera = V
end)
